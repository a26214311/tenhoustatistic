<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link href="index.css" rel="stylesheet">
  <title>Title</title>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
  <script type="text/javascript">
    function submit() {
      var name = document.getElementById("username").value;
      var id = document.getElementById("userid").value;
      console.log(name, id);
      if (name.length < 1 || id.length < 1) {
        alert('请输入正确的ID');
        return
      }
      var url = '/adduser?' + 'id=' + id + '&name=' + name;

      $.get(url, function (response, status) {
        if (status == 'success') {
          var name = document.getElementById("username").value = '';
          var id = document.getElementById("userid").value = '';
          gettable();
        }
      })
    }

    function gettable() {
      var url = '/gettable';
      document.getElementById("main").innerHTML = '刷新中，请稍后';
      $.get(url, function (response, status) {
        if (status == 'success') {
          document.getElementById("main").innerHTML = response;
        } else {
          document.getElementById("main").innerHTML = 'error';
        }
      });
    }
    $.get('/getdata', function(d){
      if(d.d && d.m){
        var user = d.d, match = d.m, th = $('thead'),  tb = $('tbody');
        th.append(
          '<tr>' +
            '<th>场次</th>' +
            '<th>' +
            Object.keys(user).join('</th><th>') +
            '</th>' +
          '</tr>');
        var userKeys = Object.keys(user).sort(function(a,b){return user[b].j-user[a].j});
        for(var i = 0; i < match.length; i++){
          var tdlist = '';
          for(var j = 0; j < userKeys.length; j++){
            tdlist += '<td class="match" valign="middle">';
            tdlist += user[userKeys[j]].list[i];
            tdlist += '</td>'
          }
          tb.append(
            '<tr>' +
              '<td>' + match[i] + '</td>' +
              tdlist +
            '</tr>')
        }
      }
    });
  </script>
</head>
<body>
<div class="container">
  <div class="row actions">
    <div class="col-xs-2">
      <input class="form-control" id="username" placeholder="天凤ID">
    </div>
    <div class="col-xs-3">
      <input class="form-control" id="userid" placeholder="QQ号">
    </div>
    <div class="col-xs-4">
      <button class="btn btn-default" onclick="submit();">提交</button>
    </div>
  </div>
  <div id="main">
    <table class="table table-bordered table-striped table-hover">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</body>
</html>